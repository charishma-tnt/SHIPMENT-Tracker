<%= stylesheet_link_tag 'customer_show', media: 'all', 'data-turbolinks-track': 'reload' %>

<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h1>Shipment Tracker</h1>
    <nav class="nav">
      <%= link_to "Dashboard", customer_path, class: "active" %>
      <%= link_to "My Shipments", customer_path %>
      <%= link_to "Create Shipment", new_shipment_path %>
      <%= link_to "Track Shipment", track_shipments_path %>
    </nav>
    <%= button_to role_selection_path, method: :get, class: "switch-view-btn" do %>
      Switch to Delivery Partner View
    <% end %>
  </aside>

  <!-- Main content -->
  <main class="main-content">
    <header class="header">
      <input type="text" placeholder="Search..." class="search-input" />
      <button class="notification-btn" aria-label="Notifications">
        <i class="fas fa-bell"></i>
        <span class="notification-badge"></span>
      </button>
    </header>

    <section>
      <h3 class="dashboard-welcome">Welcome back <%= current_user.customer&.name || current_user.email %>!</h3>
      <p class="dashboard-subtitle">Here's an overview of your shipments.</p>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-info">
            <p class="stat-label">Total Shipments</p>
            <p class="stat-value"><%= @shipments.count %></p>
          </div>
          <div class="stat-icon">
            <i class="fas fa-box"></i>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-info">
            <p class="stat-label">In Transit</p>
            <p class="stat-value"><%= @shipments.select { |s| s.status == 2 }.count %></p>
          </div>
          <div class="stat-icon">
            <i class="fas fa-truck"></i>
          </div>
        </div>
        <div class="stat-card pending">
          <div class="stat-info">
            <p class="stat-label">Pending</p>
            <p class="stat-value"><%= @shipments.select { |s| s.status == 0 }.count %></p>
          </div>
          <div class="stat-icon">
            <i class="fas fa-clock"></i>
          </div>
        </div>
        <div class="stat-card delivered">
          <div class="stat-info">
            <p class="stat-label">Delivered</p>
            <p class="stat-value"><%= @shipments.select { |s| s.status == 3 }.count %></p>
          </div>
          <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
          </div>
        </div>
      </div>

      <div class="recent-activity">
        <h4>Recent Activity</h4>
        <% @shipments.first(3).each do |shipment| %>
          <div class="activity-item">
            <div class="activity-icon">
              <i class="fas fa-box"></i>
            </div>
            <div>
              <p class="activity-text">Shipment #<%= shipment.id %> <%= shipment.status_humanize %></p>
              <p class="activity-date"><%= l(shipment.updated_at, format: :short) %></p>
            </div>
          </div>
        <% end %>
      </div>

      <div class="quick-actions">
        <%= button_to "Create New Shipment", new_shipment_path, method: :get %>
        <%= button_to "Track Shipment", track_shipments_path, method: :get, class: "track-btn" %>
      </div>

      <div class="track-section">
        <h4>Track a Shipment</h4>
        <%= form_with url: track_shipments_path, method: :get, local: true do %>
          <input type="text" name="shipment_id" placeholder="Enter Shipment ID" />
          <button type="submit">Track</button>
        <% end %>
      </div>

      <div class="shipments-table-container">
        <h3>My Shipments</h3>
        <table class="shipments-table">
          <thead>
            <tr>
              <th>Shipment ID</th>
              <th>Destination</th>
              <th>Status</th>
              <th>Updated</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @shipments.each do |shipment| %>
              <tr>
                <td><%= shipment.id %></td>
                <td><%= shipment.target %></td>
                <td><%= shipment.status_humanize %></td>
                <td><%= l(shipment.updated_at, format: :short) %></td>
                <td><%= link_to "Show", shipment_path(shipment), class: "show-link" %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </section>
  </main>
</div>
