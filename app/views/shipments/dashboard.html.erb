<%= stylesheet_link_tag 'dashboard', media: 'all', 'data-turbolinks-track': 'reload' %>
<div class="min-h-screen flex dashboard-body">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>Shipment Tracker</h2>
    <nav>
      <%= link_to "Dashboard", dashboard_shipments_path, class: "nav-link active" %>
      <%= link_to "My Shipments", shipments_path, class: "nav-link" %>
      <%= link_to "Create Shipment", new_shipment_path, class: "nav-link create" %>
      <%= link_to "Track Shipment", track_shipments_path, class: "nav-link track" %>
    </nav>
    <footer>
      &copy; <%= Time.current.year %> Shipment Tracker
    </footer>
  </aside>

  <!-- Main content -->
  <main class="main-content">
    <header class="header">
      <div class="user-info">
        <div class="user-avatar">
          <%= current_user.email.to_s.first.upcase %>
        </div>
        <div class="user-details">
          <p class="email"><%= current_user.email %></p>
          <p class="role">
            <% if current_user.customer? %>Customer
            <% elsif current_user.delivery_partner? %>Delivery Partner
            <% elsif current_user.admin? %>Admin
            <% end %>
          </p>
        </div>
      </div>
      <div>
        <%= link_to "View My Shipments", shipments_path, class: "button-primary" %>
      </div>
    </header>

    <section class="stats-grid">
      <div class="stat-card">
        <div class="stat-info">
          <p class="stat-label">Total Shipments</p>
          <p class="stat-value"><%= @total_shipments %></p>
        </div>
        <div class="stat-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7M16 3v4M8 3v4m-5 4h18" />
          </svg>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-info">
          <p class="stat-label">In Transit</p>
          <p class="stat-value"><%= @in_transit_count %></p>
        </div>
        <div class="stat-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 17v-6a2 2 0 012-2h6" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h7l-1 5h-6a2 2 0 01-2-2v-3z" />
            <circle cx="7" cy="17" r="2" />
            <circle cx="17" cy="17" r="2" />
          </svg>
        </div>
      </div>
      <div class="stat-card pending">
        <div class="stat-info">
          <p class="stat-label">Pending</p>
          <p class="stat-value"><%= @pending_count %></p>
        </div>
        <div class="stat-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3" />
            <circle cx="12" cy="12" r="10" />
          </svg>
        </div>
      </div>
      <div class="stat-card delivered">
        <div class="stat-info">
          <p class="stat-label">Delivered</p>
          <p class="stat-value"><%= @delivered_count %></p>
        </div>
        <div class="stat-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
          </svg>
        </div>
      </div>
    </section>

    <% if @delivered_shipments.any? %>
      <section class="table-section">
        <h2>Delivered Shipments</h2>
        <table>
          <thead>
            <tr>
              <th>Shipment ID</th>
              <th>Destination</th>
              <th>Status</th>
              <th>Updated</th>
            </tr>
          </thead>
          <tbody>
            <% @delivered_shipments.each_with_index do |shipment, index| %>
              <tr class="<%= index.even? ? 'even' : 'odd' %>">
                <td><%= shipment.id %></td>
                <td><%= shipment.target %></td>
                <td><%= shipment.status_humanize %></td>
                <td><%= shipment.updated_at.strftime("%B %d, %Y at %I:%M %p") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </section>
    <% end %>

    <% unless current_user.customer? %>
      <section class="table-section">
        <div class="flex justify-between items-center mb-6">
          <h2>Recent Activity</h2>
          <%= link_to "View All", shipments_path, class: "text-blue-600 hover:underline text-sm" %>
        </div>
        <table>
          <thead>
            <tr class="bg-blue-600 text-white uppercase text-sm">
              <th>Shipment ID</th>
              <th>Source</th>
              <th>Target</th>
              <th>Status</th>
              <th>Last Updated</th>
            </tr>
          </thead>
          <tbody>
            <% @recent_shipments.each_with_index do |shipment, index| %>
              <tr class="<%= index.even? ? 'even' : 'odd' %>">
                <td class="text-blue-900 font-medium"><%= shipment.id %></td>
                <td class="text-blue-700"><%= shipment.source %></td>
                <td class="text-blue-700"><%= shipment.target %></td>
                <td class="text-blue-700"><%= shipment.status_humanize %></td>
                <td class="text-blue-700"><%= shipment.updated_at.strftime("%B %d, %Y at %I:%M %p") %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </section>
    <% end %>

    <div class="flex flex-col sm:flex-row gap-4 mb-12">
      <%= link_to new_shipment_path, class: "create-shipment-btn" do %>
        Create New Shipment
      <% end %>
    </div>

    <section class="track-section">
      <p>Track your shipments using the tracking ID!</p>
      <%= render "tracking_form" %>
    </section>
  </main>
</div>
